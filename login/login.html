<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>log-in</title>
</head>
<link rel="stylesheet" href="../login/login.css">
<script src="/routers/login.router.js"></script>

<body>
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.6.0/kakao.min.js"
        integrity="sha384-6MFdIr0zOira1CHQkedUqJVql0YtcZA1P0nbPrQYJXVJZUkTk/oX4U9GhUIs3/z8"
        crossorigin="anonymous"></script>
    <script>
        Kakao.init('b0a1d518423fe080e8670ff0f662010f'); // 사용하려는 앱의 JavaScript 키 입력
    </script>
    <div class="login-wrapper">
        <h2>Login</h2>
        <div id="login-form">
            <input id="email" type="text" name="email" placeholder="Email">
            <input id="password" type="password" name="password" placeholder="Password">
            <div class="button-list">
                <input type="submit" onclick="loginTry()" style="width: 50%">
                <a style="display: flex;
                flex-direction: column-reverse;" id="kakao-login-btn" href="javascript:loginWithKakao()">
                    <img src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg" width="100%"
                        height="39px" alt="카카오 로그인 버튼" />
                </a>
            </div>
            <button class="api-btn" onclick="kakaoLogout()">로그아웃</button>
        </div>
        <p id="token-result"></p>
    </div>

    <script>
        function loginWithKakao() {
            Kakao.Auth.authorize({
                redirectUri: 'http://127.0.0.1:5500/login/login.html',
            });

        }
        async function loginTry() {
            const email = document.getElementById("email").value
            const password = document.getElementById("password").value

            const xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:3018/log-in");
            xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");
            xhr.send(JSON.stringify({ "email": email, "password": password }))
            xhr.onload = () => {
                if (xhr.status >= 200 && xhr.status <= 300) {
                    const res = JSON.parse(xhr.response);
                    console.log(res);
                } else {
                    console.error(xhr.status, xhr.statusText);
                }
            }
        }
        // 아래는 데모를 위한 UI 코드입니다.
        displayToken()
        function displayToken() {
            var token = getCookie('authorize-access-token');

            if (token) {
                Kakao.Auth.setAccessToken(token);
                Kakao.Auth.getStatusInfo()
                    .then(function (res) {
                        if (res.status === 'connected') {
                            document.getElementById('token-result').innerText
                                = 'login success, token: ' + Kakao.Auth.getAccessToken();
                        }
                    })
                    .catch(function (err) {
                        Kakao.Auth.setAccessToken(null);
                    });
            }
        }

        function getCookie(name) {
            var parts = document.cookie.split(name + '=');
            if (parts.length === 2) { return parts[1].split(';')[0]; }
        }

        // 로그아웃 기능 - 카카오 서버에 접속하는 엑세스 토큰을 만료, 사용자 어플리케이션의 로그아웃은 따로 진행.
        function kakaoLogout() {
            if (!Kakao.Auth.getAccessToken()) {
                alert('Not logged in.');
                return;
            }
            Kakao.Auth.logout(function () {
                alert('logout ok\naccess token -> ' + Kakao.Auth.getAccessToken());
            });
        }
    </script>
    </script>
</body>

</html>